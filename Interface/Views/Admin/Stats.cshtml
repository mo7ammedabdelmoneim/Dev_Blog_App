@model AdminStatsViewModel
@{
    Layout = "_AdminLayout";
}
<div class="p-6 bg-gray-50 min-h-screen">
    <h1 class="text-2xl font-bold mb-6">📊 Platform Statistics</h1>

    <!-- Cards -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10">
        <div class="bg-white shadow rounded-xl p-4 text-center">
            <h3 class="text-gray-500 text-sm">Avg Comments / Post</h3>
            <p class="text-2xl font-bold text-indigo-600">@Model.AvgCommentsPerPost.ToString("0.0")</p>
        </div>

        <div class="bg-white shadow rounded-xl p-4 text-center">
            <h3 class="text-gray-500 text-sm">Avg Reacts / Post</h3>
            <p class="text-2xl font-bold text-pink-600">@Model.AvgReactsPerPost.ToString("0.0")</p>
        </div>
    </div>

    <!-- Growth Charts -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="bg-white shadow rounded-xl p-6">
            <h2 class="font-semibold mb-3">📈 User Growth Over Time</h2>
            <canvas id="userGrowthChart"></canvas>
        </div>

        <div class="bg-white shadow rounded-xl p-6">
            <h2 class="font-semibold mb-3">📝 Post Growth Over Time</h2>
            <canvas id="postGrowthChart"></canvas>
        </div>
    </div>

    <!-- Category and Roles -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white shadow rounded-xl p-6">
            <h2 class="font-semibold mb-3">🏷️ Top Categories</h2>
            <canvas id="categoryChart"></canvas>
        </div>

        <div class="bg-white shadow rounded-xl p-6">
            <h2 class="font-semibold mb-3">👥 Users by Role</h2>
            <canvas id="roleChart"></canvas>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // البيانات القادمة من السيرفر
        const userGrowth = @Html.Raw(Json.Serialize(Model.MonthlyUserGrowth));
        const postGrowth = @Html.Raw(Json.Serialize(Model.MonthlyPostGrowth));
        const categories = @Html.Raw(Json.Serialize(Model.TopCategories));
        const roles = @Html.Raw(Json.Serialize(Model.RoleCounts));

        // 🧩 تحويل البيانات إلى Arrays بسيطة
        const userLabels = userGrowth.map(x => x.Month);
        const userData = userGrowth.map(x => x.Count);

        const postLabels = postGrowth.map(x => x.Month);
        const postData = postGrowth.map(x => x.Count);

        const categoryLabels = categories.map(x => x.Name);
        const categoryData = categories.map(x => x.PostCount);

        const roleLabels = roles.map(x => x.RoleName);
        const roleData = roles.map(x => x.Count);

        // 🎨 Line Chart - User Growth
        new Chart(document.getElementById('userGrowthChart'), {
            type: 'line',
            data: {
                labels: userLabels,
                datasets: [{
                    label: 'New Users',
                    data: userData,
                    borderColor: '#6366f1',
                    backgroundColor: 'rgba(99, 102, 241, 0.2)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // 🎨 Line Chart - Post Growth
        new Chart(document.getElementById('postGrowthChart'), {
            type: 'line',
            data: {
                labels: postLabels,
                datasets: [{
                    label: 'New Posts',
                    data: postData,
                    borderColor: '#22c55e',
                    backgroundColor: 'rgba(34, 197, 94, 0.2)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // 🎨 Bar Chart - Top Categories
        new Chart(document.getElementById('categoryChart'), {
            type: 'bar',
            data: {
                labels: categoryLabels,
                datasets: [{
                    label: 'Posts per Category',
                    data: categoryData,
                    backgroundColor: [
                        '#6366f1',
                        '#22c55e',
                        '#f59e0b',
                        '#ef4444',
                        '#3b82f6'
                    ],
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // 🎨 Pie Chart - Roles Distribution
        new Chart(document.getElementById('roleChart'), {
            type: 'pie',
            data: {
                labels: roleLabels,
                datasets: [{
                    label: 'Users by Role',
                    data: roleData,
                    backgroundColor: [
                        '#6366f1',
                        '#f59e0b',
                        '#22c55e',
                        '#ef4444',
                        '#3b82f6'
                    ]
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#374151',
                            font: { size: 12 }
                        }
                    }
                }
            }
        });
    </script>
}

