@model AddPostViewModel
@{
    Layout = "_AdminLayout";
    bool isEdit = Model.Id != Guid.Empty;
    ViewData["Title"] = isEdit ? "Edit Post" : "Add New Post";
}

<link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote.min.css" rel="stylesheet">

<section class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl p-10 mt-10">
    <div class="flex items-center justify-between mb-8">
        <h2 class="text-3xl font-bold text-gray-800 flex items-center gap-2">
            📝 @(isEdit ? "Edit Post" : "Add New Post")
        </h2>
        <a asp-action="Index" class="text-sm text-indigo-600 hover:underline">
            ← Back to Posts
        </a>
    </div>

    <form asp-action="Add" method="post" enctype="multipart/form-data" class="space-y-8">
        <!-- ID -->
        <input asp-for="Id" type="hidden" />

        <!-- Title -->
        <div>
            <label asp-for="Title" class="block text-sm font-semibold text-gray-700 mb-2">Title</label>
            <input asp-for="Title" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter post title..." />
            <span asp-validation-for="Title" class="text-red-500 text-sm"></span>
        </div>

        <!-- Content (Rich Editor) -->
        <div>
            <label asp-for="Content" class="block text-sm font-semibold text-gray-700 mb-2">Content</label>
            <textarea id="editor" asp-for="Content"></textarea>
            <span asp-validation-for="Content" class="text-red-500 text-sm"></span>
        </div>

        <!-- Category -->
        <div>
            <label asp-for="CategoryId" class="block text-sm font-semibold text-gray-700 mb-2">Category</label>
            <select asp-for="CategoryId" asp-items="ViewBag.Categories" class="w-full border border-gray-300 rounded-lg p-3 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                <option value="">-- Select a Category --</option>
            </select>
            <span asp-validation-for="CategoryId" class="text-red-500 text-sm"></span>
        </div>

        <!-- Tags -->
        <div>
            <label asp-for="Tags" class="block text-sm font-semibold text-gray-700 mb-2">Tags</label>
            <select asp-for="Tags" asp-items="ViewBag.Tags" multiple class="w-full border border-gray-300 rounded-lg p-3 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 h-32">
            </select>
            <p class="text-xs text-gray-400 mt-1">Hold CTRL (or CMD on Mac) to select multiple tags.</p>
        </div>

        <!-- Thumbnail -->
        <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2" for="Cover">Cover Image</label>

            <input type="file" asp-for="Cover" accept="image/*" class="border rounded-lg p-2 w-full" onchange="previewImage(event)">

            <div class="mt-3">
                <img id="imagePreview"
                     src="@(isEdit && !string.IsNullOrEmpty(Model.ExistingCoverUrl) ? Model.ExistingCoverUrl : "#")"
                     alt="Image Preview"
                     class="@(isEdit && !string.IsNullOrEmpty(Model.ExistingCoverUrl) ? "w-64 h-40 object-cover rounded-xl border-2 border-gray-200 shadow-md transition-all duration-300 hover:scale-105" : "hidden")" />
            </div>
        </div>

        <!-- Submit -->
        <div class="flex justify-end pt-6">
            <button type="submit"
                    class="flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-indigo-500 text-white px-6 py-3 rounded-xl shadow-md hover:shadow-lg hover:from-indigo-700 transition-all font-semibold">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                <span>@(isEdit ? "Update Post" : "Add Post")</span>
            </button>
        </div>
    </form>
</section>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script src="https://cdn.ckeditor.com/ckeditor5/41.2.1/classic/ckeditor.js"></script>
    <script>
        ClassicEditor
            .create(document.querySelector('#editor'))
            .catch(error => console.error(error));

        function previewImage(event) {
            const input = event.target;
            const preview = document.getElementById('imagePreview');

            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            } else {
                preview.src = "#";
                preview.classList.add('hidden');
            }
        }
    </script>
}
