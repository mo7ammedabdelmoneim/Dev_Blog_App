@using Microsoft.AspNetCore.Identity
@model IEnumerable<AdminUserViewModel>
@{
    ViewBag.Title = "_AdminLayout";
}
<div class="bg-white shadow-md rounded-2xl p-6">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-semibold text-gray-700">Manage Users</h2>
        <form method="get" class="flex gap-2">
            <input type="text" name="search" placeholder="Search users..."
                   class="border border-gray-300 rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-indigo-500">
            <select name="role" class="border border-gray-300 rounded-lg px-3 py-1 text-sm">
                <option value="">All Roles</option>
                @foreach (var r in ViewBag.Roles)
                {
                    <option value="@r">@r</option>
                }
            </select>
            <button class="bg-indigo-600 text-white px-3 py-1 rounded-lg hover:bg-indigo-700 text-sm">Filter</button>
        </form>
    </div>

    @if (TempData["Message"] != null)
    {
        <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-2 rounded mb-3">
            @TempData["Message"]
        </div>
    }

    <div class="overflow-x-auto">
        <table class="min-w-full text-left border border-gray-200 rounded-lg">
            <thead class="bg-gray-50 text-gray-600 uppercase text-xs font-semibold">
                <tr>
                    <th class="px-4 py-2">User Name</th>
                    <th class="px-4 py-2">Email</th>
                    <th class="px-4 py-2">Role</th>
                    <th class="px-4 py-2">Join Date</th>
                    <th class="px-4 py-2 text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model)
                {
                    <tr class="border-b hover:bg-gray-50">
                        <td class="px-4 py-2">@user.UserName</td>
                        <td class="px-4 py-2">@user.Email</td>
                        <td class="px-4 py-2">
                            <form method="post" asp-action="UpdateRole" class="flex items-center gap-2">
                                <input type="hidden" name="userId" value="@user.Id" />
                                <select name="newRole" class="border border-gray-300 rounded-md px-2 py-1 text-sm">
                                    @foreach (var r in ViewBag.Roles)
                                    {
                                        if(user.CurrentRole == r.ToString())
                                        {
                                            <option value="@r" selected>@r</option>
                                        }else{
                                            <option value="@r">@r</option>
                                        }
                                    
                                    }
                                </select>
                                <button type="submit" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">Update</button>
                            </form>
                        </td>
                        <td class="px-4 py-2">@user.CreatedAt.ToString("dd MMM yyyy")</td>
                        <td class="px-4 py-2 text-center">
                            <form method="post" asp-action="Delete" asp-route-id="@user.Id"
                                  onsubmit="return confirm('Are you sure you want to delete this user?');">
                                <button type="submit"
                                        class="text-red-600 hover:text-red-800 font-medium">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
